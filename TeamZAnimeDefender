-- Services used
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 500) -- Adjusted for mobile and PC
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true

-- Main Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 60)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Anime Defenders - Script Hub"
Title.TextScaled = true
Title.TextColor3 = Color3.new(1, 1, 1)
Title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Title.Parent = MainFrame

-- Categories
local CategoryFrame = Instance.new("Frame")
CategoryFrame.Size = UDim2.new(0, 160, 0, 400)
CategoryFrame.Position = UDim2.new(0, 10, 0, 70)
CategoryFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
CategoryFrame.Parent = MainFrame

local CategoryTitle = Instance.new("TextLabel")
CategoryTitle.Size = UDim2.new(1, 0, 0, 40)
CategoryTitle.Text = "Categories"
CategoryTitle.TextScaled = true
CategoryTitle.TextColor3 = Color3.new(1, 1, 1)
CategoryTitle.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
CategoryTitle.Parent = CategoryFrame

-- Function to create buttons
local function createCategoryButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 150, 0, 50)
    button.Position = UDim2.new(0, 5, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.SourceSansBold
    button.TextScaled = true
    button.Parent = CategoryFrame
    return button
end

local RollbackButton = createCategoryButton("Rollback", 50)
local AutoFarmButton = createCategoryButton("AutoFarm", 110)

-- Rollback Frame
local RollbackFrame = Instance.new("Frame")
RollbackFrame.Size = UDim2.new(0, 250, 0, 320)
RollbackFrame.Position = UDim2.new(0, 180, 0, 70)
RollbackFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
RollbackFrame.Visible = false
RollbackFrame.Parent = MainFrame

-- Rollback Title
local RollbackTitle = Instance.new("TextLabel")
RollbackTitle.Size = UDim2.new(1, 0, 0, 60)
RollbackTitle.Text = "Trait Rollback"
RollbackTitle.TextScaled = true
RollbackTitle.TextColor3 = Color3.new(1, 1, 1)
RollbackTitle.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
RollbackTitle.Parent = RollbackFrame

-- Rollback Options
local function createActionButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 220, 0, 50)
    button.Position = UDim2.new(0.5, -110, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.SourceSansBold
    button.TextScaled = true
    button.Parent = RollbackFrame
    return button
end

local EnableRollback = createActionButton("Activate Rollback", 70)
local RejoinButton = createActionButton("Rejoin Server", 140)

-- Function to display categories
RollbackButton.MouseButton1Click:Connect(function()
    RollbackFrame.Visible = true
end)

AutoFarmButton.MouseButton1Click:Connect(function()
    -- Add AutoFarm functionalities here
end)

-- Rollback functionality
EnableRollback.MouseButton1Click:Connect(function()
    print("Rollback activated!")
    -- Call the function for rollback (simulation here)
    traitReroll()
end)

RejoinButton.MouseButton1Click:Connect(function()
    print("Rejoining server...")
    TeleportService:Teleport(game.PlaceId)
end)

-- Anti-AFK function
local VirtualUser = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    wait(1)
    VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
end)

-- Trait Reroll function with rollback
function traitReroll()
    local rerollsUsed = 0
    local passiveObtained = false

    -- Reroll loop
    while not passiveObtained and rerollsUsed < 5 do
        rerollsUsed = rerollsUsed + 1
        passiveObtained = (math.random(1, 10) == 1)
        wait(2)
    end

    if not passiveObtained then
        print("Rolling back...")
        LocalPlayer:Kick("Rejoining to rollback...")
        wait(5)
        TeleportService:Teleport(game.PlaceId)
    else
        print("Trait obtained!")
    end
end

-- LAG Options / Hitbox adjustments (Placeholder for now)
