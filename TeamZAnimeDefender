-- Services utilisés
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- GUI principal
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Fenêtre principale
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.Position = UDim2.new(0.5, -200, 0.3, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true

-- Titre principal
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 50)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Anime Defenders - Custom Script Hub"
Title.TextScaled = true
Title.TextColor3 = Color3.new(1, 1, 1)
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.Parent = MainFrame

-- Catégories (Rollback, AutoFarm, etc.)
local CategoryFrame = Instance.new("Frame")
CategoryFrame.Size = UDim2.new(0, 150, 0, 250)
CategoryFrame.Position = UDim2.new(0, 0, 0, 50)
CategoryFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
CategoryFrame.Parent = MainFrame

local CategoryTitle = Instance.new("TextLabel")
CategoryTitle.Size = UDim2.new(1, 0, 0, 30)
CategoryTitle.Text = "Categories"
CategoryTitle.TextScaled = true
CategoryTitle.TextColor3 = Color3.new(1, 1, 1)
CategoryTitle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
CategoryTitle.Parent = CategoryFrame

-- Boutons de catégories
local RollbackButton = Instance.new("TextButton")
RollbackButton.Size = UDim2.new(0, 140, 0, 50)
RollbackButton.Position = UDim2.new(0, 5, 0, 40)
RollbackButton.Text = "Rollback"
RollbackButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
RollbackButton.TextColor3 = Color3.new(1, 1, 1)
RollbackButton.Parent = CategoryFrame

local AutoFarmButton = Instance.new("TextButton")
AutoFarmButton.Size = UDim2.new(0, 140, 0, 50)
AutoFarmButton.Position = UDim2.new(0, 5, 0, 100)
AutoFarmButton.Text = "AutoFarm"
AutoFarmButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
AutoFarmButton.TextColor3 = Color3.new(1, 1, 1)
AutoFarmButton.Parent = CategoryFrame

-- Frame de Rollback
local RollbackFrame = Instance.new("Frame")
RollbackFrame.Size = UDim2.new(0, 230, 0, 250)
RollbackFrame.Position = UDim2.new(0, 160, 0, 50)
RollbackFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
RollbackFrame.Visible = false
RollbackFrame.Parent = MainFrame

-- Titre Rollback
local RollbackTitle = Instance.new("TextLabel")
RollbackTitle.Size = UDim2.new(1, 0, 0, 50)
RollbackTitle.Text = "Trait Rollback"
RollbackTitle.TextScaled = true
RollbackTitle.TextColor3 = Color3.new(1, 1, 1)
RollbackTitle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
RollbackTitle.Parent = RollbackFrame

-- Options Rollback
local EnableRollback = Instance.new("TextButton")
EnableRollback.Size = UDim2.new(0, 200, 0, 50)
EnableRollback.Position = UDim2.new(0.5, -100, 0, 60)
EnableRollback.Text = "Activate Rollback"
EnableRollback.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
EnableRollback.TextColor3 = Color3.new(1, 1, 1)
EnableRollback.Parent = RollbackFrame

local RejoinButton = Instance.new("TextButton")
RejoinButton.Size = UDim2.new(0, 200, 0, 50)
RejoinButton.Position = UDim2.new(0.5, -100, 0, 130)
RejoinButton.Text = "Rejoin Server"
RejoinButton.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
RejoinButton.TextColor3 = Color3.new(1, 1, 1)
RejoinButton.Parent = RollbackFrame

-- Fonctionnement de Rollback et Rejoin
EnableRollback.MouseButton1Click:Connect(function()
    print("Rollback activé!")
    -- Appel de la fonction pour Rollback (simulation ici)
    traitReroll()
end)

RejoinButton.MouseButton1Click:Connect(function()
    print("Rejoining server...")
    TeleportService:Teleport(game.PlaceId)
end)

-- Affichage des catégories
RollbackButton.MouseButton1Click:Connect(function()
    RollbackFrame.Visible = true
end)

AutoFarmButton.MouseButton1Click:Connect(function()
    -- Ajout des fonctionnalités d'AutoFarm ici
end)

-- Fonction anti-AFK
local VirtualUser = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    wait(1)
    VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- Fonction de Trait Reroll avec rollback
function traitReroll()
    local rerollsUsed = 0
    local passiveObtained = false

    -- Boucle de reroll
    while not passiveObtained and rerollsUsed < 5 do
        rerollsUsed = rerollsUsed + 1
        passiveObtained = (math.random(1, 10) == 1)
        wait(2)
    end

    if not passiveObtained then
        print("Rollback en cours...")
        LocalPlayer:Kick("Rejoining to rollback...")
        wait(5)
        TeleportService:Teleport(game.PlaceId)
    else
        print("Trait obtenu!")
    end
end

-- LAG Options / Hitbox adjustments (Placeholder pour le moment)
