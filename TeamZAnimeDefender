-- Services Roblox
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser") -- Utilisé pour simuler l'activité du joueur

-- Variables du joueur et de son personnage
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local traits = {"Trait1", "Trait2", "Trait3", "Trait4", "Trait5"} -- Liste des traits possibles
local playerResources = 10 -- Ressources que le joueur a pour reroll
local currentTrait = "Trait1" -- Trait actuel du joueur
local previousTrait = currentTrait -- Pour le rollback
local isAutoFarming = false -- Etat pour savoir si le joueur est en mode combat automatique
local rollbackEnabled = false -- Checkbox pour activer ou désactiver le rollback
local antiAfkEnabled = true -- Etat pour activer/désactiver l'anti-AFK

-- Fonction pour effectuer le reroll
local function performReroll()
    if playerResources <= 0 then
        print("Pas assez de ressources pour effectuer un reroll.")
        return
    end
    
    -- Sauvegarde le trait actuel pour rollback
    previousTrait = currentTrait
    
    -- Reroll (choix aléatoire d'un nouveau trait)
    local newTrait = traits[math.random(1, #traits)]
    
    -- Met à jour le trait actuel
    currentTrait = newTrait
    
    print("Nouveau trait obtenu : " .. currentTrait)
    playerResources = playerResources - 1 -- Déduit une ressource pour le reroll

    -- Si rollback est activé, on restaure le trait précédent si le joueur n'aime pas le nouveau
    if rollbackEnabled then
        rollback()
    end
end

-- Fonction pour effectuer le rollback
local function rollback()
    if previousTrait then
        print("Rollback au trait précédent : " .. previousTrait)
        currentTrait = previousTrait
    else
        print("Aucun trait précédent à restaurer.")
    end
end

-- Fonction pour activer ou désactiver le combat automatique
local function toggleAutoFarm()
    isAutoFarming = not isAutoFarming
    if isAutoFarming then
        print("Combat automatique activé.")
        -- Simule le gain de ressources via le combat automatique
        RunService.Heartbeat:Connect(function()
            if isAutoFarming then
                wait(5) -- Gagne des ressources toutes les 5 secondes
                playerResources = playerResources + 1
                print("Ressources gagnées: " .. playerResources)
            end
        end)
    else
        print("Combat automatique désactivé.")
    end
end

-- Fonction pour rejoindre un nouveau serveur
local function rejoinServer()
    print("Rejoining server...")
    TeleportService:Teleport(game.PlaceId) -- Téléporte vers un nouveau serveur avec le même PlaceId
end

-- Fonction Anti-AFK
local function antiAfk()
    if antiAfkEnabled then
        player.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new()) -- Simule un clic droit pour éviter l'inactivité
            print("Anti-AFK déclenché.")
        end)
    end
end

-- Interface utilisateur (GUI)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Grande frame principale
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 400) -- Agrandi pour inclure la nouvelle section
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BorderSizePixel = 3
MainFrame.BorderColor3 = Color3.fromRGB(255, 0, 0) -- Bordures rouges
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true

-- Titre
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(0, 400, 0, 50)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Game Menu"
Title.TextScaled = true
Title.TextColor3 = Color3.new(1, 1, 1)
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.Parent = MainFrame

-- Section pour activer Auto Farm
local AutoFarmButton = Instance.new("TextButton")
AutoFarmButton.Size = UDim2.new(0, 200, 0, 50)
AutoFarmButton.Position = UDim2.new(0, 100, 0, 60)
AutoFarmButton.Text = "Toggle Auto Farm"
AutoFarmButton.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
AutoFarmButton.TextColor3 = Color3.new(1, 1, 1)
AutoFarmButton.Parent = MainFrame

AutoFarmButton.MouseButton1Click:Connect(toggleAutoFarm)

-- Section pour activer le Trait Reroll
local RerollButton = Instance.new("TextButton")
RerollButton.Size = UDim2.new(0, 200, 0, 50)
RerollButton.Position = UDim2.new(0, 100, 0, 120)
RerollButton.Text = "Reroll Trait"
RerollButton.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
RerollButton.TextColor3 = Color3.new(1, 1, 1)
RerollButton.Parent = MainFrame

RerollButton.MouseButton1Click:Connect(performReroll)

-- Checkbox pour activer/désactiver le Rollback
local RollbackCheckbox = Instance.new("TextButton")
RollbackCheckbox.Size = UDim2.new(0, 200, 0, 50)
RollbackCheckbox.Position = UDim2.new(0, 100, 0, 180)
RollbackCheckbox.Text = "Enable Rollback"
RollbackCheckbox.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
RollbackCheckbox.TextColor3 = Color3.new(1, 1, 1)
RollbackCheckbox.Parent = MainFrame

RollbackCheckbox.MouseButton1Click:Connect(function()
    rollbackEnabled = not rollbackEnabled
    if rollbackEnabled then
        RollbackCheckbox.Text = "Rollback Enabled"
        RollbackCheckbox.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
    else
        RollbackCheckbox.Text = "Enable Rollback"
        RollbackCheckbox.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    end
end)

-- Section pour Rejoin Server
local RejoinButton = Instance.new("TextButton")
RejoinButton.Size = UDim2.new(0, 200, 0, 50)
RejoinButton.Position = UDim2.new(0, 100, 0, 240)
RejoinButton.Text = "Rejoin Server"
RejoinButton.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
RejoinButton.TextColor3 = Color3.new(1, 1, 1)
RejoinButton.Parent = MainFrame

RejoinButton.MouseButton1Click:Connect(rejoinServer)

-- Activation de l'Anti-AFK dès le lancement
antiAfk()
