-- Services used
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

-- Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 500, 0, 600) -- Adjusted for better layout
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -300)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui
MainFrame.Active = true
MainFrame.Draggable = true

-- Main Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 60)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Anime Defenders - TeamZ Hub" -- Updated title
Title.TextScaled = true
Title.TextColor3 = Color3.new(1, 1, 1)
Title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Title.Font = Enum.Font.SourceSansBold
Title.TextStrokeTransparency = 0.5
Title.Parent = MainFrame

-- Categories Frame
local CategoryFrame = Instance.new("Frame")
CategoryFrame.Size = UDim2.new(0, 160, 0, 520) -- Adjusted for better spacing
CategoryFrame.Position = UDim2.new(0, 10, 0, 70)
CategoryFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
CategoryFrame.BorderSizePixel = 0
CategoryFrame.Parent = MainFrame

local CategoryTitle = Instance.new("TextLabel")
CategoryTitle.Size = UDim2.new(1, 0, 0, 40)
CategoryTitle.Text = "Categories"
CategoryTitle.TextScaled = true
CategoryTitle.TextColor3 = Color3.new(1, 1, 1)
CategoryTitle.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
CategoryTitle.Font = Enum.Font.SourceSansBold
CategoryTitle.Parent = CategoryFrame

-- Function to create buttons with rounded corners
local function createCategoryButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 150, 0, 50)
    button.Position = UDim2.new(0, 5, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.SourceSans
    button.TextScaled = true
    button.AutoButtonColor = false
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
    end)
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    end)
    button.Parent = CategoryFrame
    return button
end

local RollbackButton = createCategoryButton("Rollback", 50)
local AutoFarmButton = createCategoryButton("AutoFarm", 110)
local LobbyButton = createCategoryButton("Lobby", 170) -- New Lobby category

-- Rollback Frame
local RollbackFrame = Instance.new("Frame")
RollbackFrame.Size = UDim2.new(0, 300, 0, 400)
RollbackFrame.Position = UDim2.new(0, 180, 0, 70)
RollbackFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
RollbackFrame.Visible = false
RollbackFrame.Parent = MainFrame

-- Rollback Title
local RollbackTitle = Instance.new("TextLabel")
RollbackTitle.Size = UDim2.new(1, 0, 0, 60)
RollbackTitle.Text = "Rollback Options"
RollbackTitle.TextScaled = true
RollbackTitle.TextColor3 = Color3.new(1, 1, 1)
RollbackTitle.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
RollbackTitle.Font = Enum.Font.SourceSansBold
RollbackTitle.Parent = RollbackFrame

-- Rollback Options
local function createActionButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 240, 0, 50)
    button.Position = UDim2.new(0.5, -120, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.SourceSansBold
    button.TextScaled = true
    button.Parent = RollbackFrame
    return button
end

local EnableRollback = createActionButton("Activate Rollback", 70)
local RejoinButton = createActionButton("Rejoin Server", 140)

-- Infinite Jump Checkbox
local InfiniteJumpFrame = Instance.new("Frame")
InfiniteJumpFrame.Size = UDim2.new(0, 300, 0, 100)
InfiniteJumpFrame.Position = UDim2.new(0, 180, 0, 400)
InfiniteJumpFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
InfiniteJumpFrame.Visible = false
InfiniteJumpFrame.Parent = MainFrame

local InfiniteJumpLabel = Instance.new("TextLabel")
InfiniteJumpLabel.Size = UDim2.new(1, 0, 0, 40)
InfiniteJumpLabel.Text = "Infinite Jump"
InfiniteJumpLabel.TextScaled = true
InfiniteJumpLabel.TextColor3 = Color3.new(1, 1, 1)
InfiniteJumpLabel.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
InfiniteJumpLabel.Font = Enum.Font.SourceSansBold
InfiniteJumpLabel.Parent = InfiniteJumpFrame

local InfiniteJumpToggle = Instance.new("TextButton")
InfiniteJumpToggle.Size = UDim2.new(0, 220, 0, 40)
InfiniteJumpToggle.Position = UDim2.new(0.5, -110, 0, 50)
InfiniteJumpToggle.Text = "Toggle Infinite Jump"
InfiniteJumpToggle.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
InfiniteJumpToggle.TextColor3 = Color3.new(1, 1, 1)
InfiniteJumpToggle.Font = Enum.Font.SourceSansBold
InfiniteJumpToggle.Parent = InfiniteJumpFrame

local infiniteJumpEnabled = false

InfiniteJumpToggle.MouseButton1Click:Connect(function()
    infiniteJumpEnabled = not infiniteJumpEnabled
    InfiniteJumpToggle.Text = infiniteJumpEnabled and "Infinite Jump: ON" or "Infinite Jump: OFF"
end)

-- Speed Slider
local SpeedFrame = Instance.new("Frame")
SpeedFrame.Size = UDim2.new(0, 300, 0, 200)
SpeedFrame.Position = UDim2.new(0, 180, 0, 510)
SpeedFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
SpeedFrame.Visible = false
SpeedFrame.Parent = MainFrame

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Size = UDim2.new(1, 0, 0, 40)
SpeedLabel.Text = "Adjust Speed"
SpeedLabel.TextScaled = true
SpeedLabel.TextColor3 = Color3.new(1, 1, 1)
SpeedLabel.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
SpeedLabel.Font = Enum.Font.SourceSansBold
SpeedLabel.Parent = SpeedFrame

local SpeedSlider = Instance.new("TextButton")
SpeedSlider.Size = UDim2.new(1, 0, 0, 40)
SpeedSlider.Position = UDim2.new(0, 0, 0, 50)
SpeedSlider.Text = "Drag to adjust speed (max 200)"
SpeedSlider.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
SpeedSlider.TextColor3 = Color3.new(1, 1, 1)
SpeedSlider.Font = Enum.Font.SourceSans
SpeedSlider.Parent = SpeedFrame

-- Update player speed when slider value changes
local minSpeed = 16 -- Default walking speed
local maxSpeed = 200
SpeedSlider.MouseButton1Down:Connect(function()
    local startPos = UserInputService:GetMouse().X

    local function onDrag()
        local mousePos = UserInputService:GetMouse().X
        local speedValue = math.clamp(math.floor((mousePos - startPos) / 2) + minSpeed, minSpeed, maxSpeed)
        LocalPlayer.Character.Humanoid.WalkSpeed = speedValue
        SpeedSlider.Text = "Speed: " .. speedValue
    end

    UserInputService.InputChanged:Connect(onDrag)

    UserInputService.InputEnded:Connect(function()
        UserInputService.InputChanged:Disconnect(onDrag)
    end)
end)

-- Placeholder for player traits
local playerTraits = {}

-- Function to save current traits
local function saveTraits()
    -- Save traits to playerTraits here
end

-- Function to restore traits
local function restoreTraits()
    -- Restore traits from playerTraits here
end

-- Rollback and Rejoin logic
EnableRollback.MouseButton1Click:Connect(function()
    print("Rollback activated!")
    traitReroll()
end)

RejoinButton.MouseButton1Click:Connect(function()
    print("Rejoining server...")
    TeleportService:Teleport(game.PlaceId)
end)

-- Show category frames
RollbackButton.MouseButton1Click:Connect(function()
    RollbackFrame.Visible = true
    InfiniteJumpFrame.Visible = false
    SpeedFrame.Visible = false
end)

AutoFarmButton.MouseButton1Click:Connect(function()
    -- Add AutoFarm functionalities here
end)

LobbyButton.MouseButton1Click:Connect(function()
    InfiniteJumpFrame.Visible = true
    SpeedFrame.Visible = true
    RollbackFrame.Visible = false
end)

-- Anti-AFK Function
local VirtualUser = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    wait(1)
    VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
end)

-- Infinite Jump Functionality
game:GetService("RunService").RenderStepped:Connect(function()
    if infiniteJumpEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.Jump = true
    end
end)
